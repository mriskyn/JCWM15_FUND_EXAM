<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Number 3</title>
    <style>
      table,
      tr,
      td,
      th {
        border: 1px solid black;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 10px;
      }

      td {
        text-align: center;
      }

      img {
        height: 60px;
      }
    </style>
  </head>
  <body>
    <h1>FORM USERS</h1>

    <form onsubmit="submitUser(event)">
      <input type="text" placeholder="username" id="add_username" />
      <input type="text" placeholder="email" id="add_email" />
      <label for="add_role">role</label>
      <select id="add_role">
        <option value="admin">admin</option>
        <option value="user">user</option>
      </select>
      <br />
      <br />
      <button type="submit">ADD USER</button>
    </form>

    <h1>USERS DATA</h1>

    <table id="users">
      <thead>
        <tr>
          <th>No</th>
          <th>Usename</th>
          <th>Email</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="users-list"></tbody>
    </table>
  </body>

  <script src="./database.js"></script>
  <script>
    function showUsers(index = null) {
      let table = document.getElementById("users");
      let tbody = table.getElementsByTagName("tbody")[0];

      let tr = "";
      dataUsers.forEach((user, i) => {
        if (i === index) {
          tr += `
                <tr>
                    <td>
                        #
                    </td>
                    <td>
                        <input id="name_edited" type="text" value="${
                          user.username
                        }">
                    </td>
                    <td>
                        <input id="email_edited" type="text" value="${
                          user.email
                        }">
                    </td>
                    <td>
                        <select id="role_edited">
                            <option value="user" ${
                              user.role === "user" ? "selected" : null
                            }>user</option>    
                            <option value="admin" ${
                              user.role === "admin" ? "selected" : null
                            }>admin</option>    
                        </select>
                    </td>
                    <td>
                        <button onclick=saveEditUser(${user.id})>SAVE</button>
                        <button onclick=cancelEditUser()>CANCEL</button>
                    </td>
                </tr>
            `;
        } else {
          tr += `
                  <tr>
                      <td>${i + 1}</td>
                      <td>${user.username}</td>
                      <td>${user.email}</td>
                      <td>${user.role}</td>
                      <td>
                          <button onclick="editUser(${i})">EDIT</button>    
                          <button onclick="deleteUser(${i})">DELETE</button>    
                      </td>
                  </tr>
              `;
        }
      });

      tbody.innerHTML = tr;
    }

    function submitUser(e) {
      e.preventDefault();

      const addUser = {
        id: dataUsers[dataUsers.length - 1].id + 1,
        username: document.getElementById("add_username").value,
        email: document.getElementById("add_email").value,
        role: document.getElementById("add_role").value,
      };

      if (!addUser.username || !addUser.email) {
        alert("Input Still Empty!");
      } else {
        dataUsers = [...dataUsers, addUser];
        showUsers();
      }
    }

    function editUser(index) {
      showUsers(index);
    }

    function deleteUser(index) {
      dataUsers.splice(index, 1);
      showUsers();
    }

    function cancelEditUser() {
      showUsers();
    }

    function saveEditUser(id) {
      id = Number(id);
      const editedUser = {
        id: id,
        username: document.getElementById("name_edited").value,
        email: document.getElementById("email_edited").value,
        role: document.getElementById("role_edited").value,
      };

      dataUsers = dataUsers.map((user) => (user.id === id ? editedUser : user));

      showUsers();
    }

    showUsers();
  </script>
</html>
